extends pug/layouts

block link
  -var selected = 'Dashboard';

block content
    .row
      .col-lg-12
        ul.nav.nav-tabs
    
    #dashboard

    //- .row
    //-     .col-lg-12
    //-       .panel.panel-default
    //-         .panel-heading Device 1
    //-         .panel-body
    //-           .canvas-wrapper
    //-             <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
    //- .row
    //-     .col-lg-12
    //-       .panel.panel-default
    //-         .panel-heading Device 2
    //-         .panel-body
    //-           .canvas-wrapper
    //-             canvas#myChart2.myChart(height='200', width='600')

    block scripts
      script(src="../../public/javascript/ajax/menuDashboard.js")
      script(src="../../public/javascript/hightcharts/highcharts.js")
      script(src="../../public/javascript/hightcharts/exporting.js")
      
      script.

       
        var times = [];
       
 

        function fetchValueByDeviceId(id,id_endpoint) {

          var URI = "/core/api/v1/devices/fetchAll?endpointcode=" + id_endpoint;
          $.getJSON(URI, function(json) {
           var values = [];//clear value old.
           var info_endpoint = {};


             
            json.Result.sort(function(a,b){
            var c = new Date(a.time);
            var d = new Date(b.time);
            return c-d;
            });

            json.Result.forEach((item) => {

              if(item.id_device === id)
              {
              values.push(item.value);
              var timeFormated = item.time;
              times.push(timeFormated);
              info_endpoint = item;
              }
            });
            values


            setTimeout(function(){
              setData(id,values,info_endpoint);
            },0);
          }).error(function() { 
               //khogn ton tai du lieu
              
              });
        };
      
        //- alert(JSON.stringify(values));
        function setData(id,values,info_endpoint){

          Highcharts.chart('container'+id, {
              title: {
                  text: '',
                  x: -20 //center
              },
              xAxis: {
                  categories: times,
              },
                yAxis: {
                    title: {
                        text: info_endpoint.unit
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }],
                },
              tooltip: {
                valueSuffix: info_endpoint.unit
              },
              legend: {
                  layout: 'vertical',
                  align: 'right',
                  verticalAlign: 'middle',
                  borderWidth: 0
              },
              series: [{
                  name: 'Device',
                  data: values
              }]
          });

        }
      